import{z as K,k as I,t as N,A as X,g as Y,B as tt,J as et,c as U,C as G,_ as q,u as st,a as at,b as O,d as E,r as x,o as b,e as D,f as t,h as w,w as S,v as k,Z as j,n as p,p as nt,i as it,F as L,j as ot,l as B,m as F,q as lt}from"./index-BEOb6O_H.js";import{G as rt,a as dt,U as ct,B as ft,g as pt}from"./gameView-BG60hCBX.js";BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141");BigInt("1000000000000000000");const vt=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");BigInt("0x8000000000000000000000000000000000000000000000000000000000000000")*BigInt(-1);BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");async function ut(o,l,d,i){const f="https://ib9fm6yjjg.execute-api.ap-northeast-2.amazonaws.com/ctp/ctp/create-prompt",h={prompt_hash:o,prompt:l,secret_hash:d,secret:i};try{const y=await(await fetch(f,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)})).json();console.log(y.message)}catch(v){console.error("Error:",v)}}const wt="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='11'%20height='18'%20viewBox='0%200%2011%2018'%20fill='none'%3e%3crect%20x='8.59265'%20y='0.928223'%20width='2.69743'%20height='11.4442'%20transform='rotate(45%208.59265%200.928223)'%20fill='black'/%3e%3crect%20width='2.69743'%20height='11.4447'%20transform='matrix(0.707107%20-0.707107%20-0.707107%20-0.707107%208.59265%2017.1123)'%20fill='black'/%3e%3c/svg%3e",mt="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='11'%20height='18'%20viewBox='0%200%2011%2018'%20fill='none'%3e%3crect%20width='2.69743'%20height='11.4442'%20transform='matrix(-0.707107%200.707107%200.707107%200.707107%202.40735%200.928223)'%20fill='black'/%3e%3crect%20x='2.40735'%20y='17.1123'%20width='2.69743'%20height='11.4447'%20transform='rotate(-135%202.40735%2017.1123)'%20fill='black'/%3e%3c/svg%3e",z="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='21'%20height='21'%20viewBox='0%200%2021%2021'%20fill='none'%3e%3ccircle%20cx='10.5'%20cy='10.0203'%20r='9'%20fill='%234DC4CF'%20stroke='black'%20stroke-width='2'/%3e%3cline%20x1='6.44978'%20y1='5.07048'%20x2='15.6422'%20y2='14.2629'%20stroke='black'%20stroke-width='2'/%3e%3cline%20x1='5.7426'%20y1='14.2629'%20x2='14.935'%20y2='5.07048'%20stroke='black'%20stroke-width='2'/%3e%3c/svg%3e";let $,M,_={Game:void 0,GameFrontend:void 0,Award:void 0,Badge:void 0};const J={gasPrice:"100000000001"};async function H(o){if(!$)try{$=new tt(o)}catch(l){console.log(l),$=new et(U.rpcUrl)}console.log($),M=await $.getSigner(),_.Game||(_.Game=new G(U.contracts.Game,rt.abi,$)),_.GameFrontend||(_.GameFrontend=new G(U.contracts.GameFrontend,dt.abi,$)),_.Award||(_.Award=new G(U.contracts.Award,ct.abi,$)),_.Badge||(_.Badge=new G(U.contracts.Badge,ft.abi,$))}function gt(o){return new Promise(l=>setTimeout(l,o))}async function W(o){for(let d=0;d<10;d++){const i=await $.getTransactionReceipt(o);if(i)return i.status==1;await gt(1e3)}return!1}async function ht(o,l){await H(o);let d=await _.Award.connect(M).allowance(M.address,await _.Game.getAddress());if(console.log(d),d<l)try{let i=await _.Award.connect(M).approve(await _.Game.getAddress(),vt,{...J});return await W(i.hash),i}catch(i){console.error(i);return}}async function xt(o,l,d,i){await H(o),console.log(l),console.log(d),console.log(i);try{let f=await _.Game.connect(M).mint(l,d,i,{...J});return await W(f.hash),f}catch(f){console.error(f);return}}async function yt(o,l,d){await H(o);const i=K("0x"+l.toString(16),32),f=I(N(`${d}`));let h;{const m=X.defaultAbiCoder().encode(["bytes32","bytes32"],[i,f]);h=await M.signMessage(Y(I(m)))}const v={tokenId:l.toString(),secretHash:f,user:M.address,sig:h},y="https://ib9fm6yjjg.execute-api.ap-northeast-2.amazonaws.com/ctp/ctp/submit-secret";try{const m=await(await fetch(y,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(v)})).json();return console.log(m.status),console.log(m.hash),{status:m.status,hash:m.hash}}catch(g){return console.error("Error:",g),{status:!1,hash:""}}}const _t={class:"modal"},bt={class:"modal-container"},$t={class:"modal-wrapper"},Ct={class:"modal-info"},St={class:"modal-info-top"},kt=["src"],Dt={class:"modal-info-title-wrapper"},Mt={class:"title-wrapper"},Tt={class:"title-text"},At={class:"type-wrapper"},Ut={class:"type-text"},Bt={class:"title-description"},It={class:"modal-info-bottom"},Vt={class:"details-title-wrapper"},Pt={class:"details-content-text"},Gt={class:"details-title-wrapper"},Nt={class:"details-content-text"},jt={class:"details-title-wrapper"},Ft={class:"details-content-text"},qt={class:"details-title-wrapper"},Ht={class:"details-award-text"},Lt={class:"bottom-wrapper"},Ot={class:"question-wrapper"},Et={class:"question-content-wrapper"},zt={class:"answer-wrapper"},Jt={class:"answer-content-input"},Wt={class:"pk-wrapper"},Rt={class:"pk-content-wrapper"},Zt={__name:"ChallengeModal",props:{nft:{type:Object,required:!0}},emits:["closeModal"],setup(o,{emit:l}){st(),at();const{walletProvider:d}=O(),{address:i,chainId:f,isConnected:h}=E(),v=o,y=l,g=x(""),m=x(""),C=x(""),T=async()=>{const u="https://ib9fm6yjjg.execute-api.ap-northeast-2.amazonaws.com/ctp/ctp/qa",s={token_id:v.nft.id.toString(),user:i.value,prompt_hash:v.nft.promptHash,question:g.value};try{const r=await(await fetch(u,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).json();console.log(r.message),m.value=r.message}catch(e){console.error("Error:",e)}},V=async()=>{await yt(d.value,v.nft.tokenId,C.value)},A=()=>{y("closeModal")},c=u=>{const s=new Date(u*1e3),e=String(s.getUTCMonth()+1).padStart(2,"0"),r=String(s.getUTCDate()).padStart(2,"0"),P=s.getUTCHours(),R=String(s.getUTCMinutes()).padStart(2,"0"),Z=P>=12?"PM":"AM",Q=P%12||12;return`${e}.${r} ${Q}:${R} ${Z}`},a=(u,s)=>{const r=(s-u)/(60*60*24);return Math.round(r)},n=u=>(u/1e18).toFixed(2);return(u,s)=>(b(),D("div",_t,[t("div",bt,[s[14]||(s[14]=t("div",{class:"modal-title-text"},"Challenge",-1)),t("div",$t,[t("div",{class:"close-wrapper"},[t("img",{src:z,alt:"close",onClick:A})]),t("div",Ct,[t("div",St,[t("img",{src:o.nft.imageUri||"@/assets/nft/0.png",alt:"nft"},null,8,kt),t("div",Dt,[s[4]||(s[4]=t("div",{class:"live-wrapper"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 12 12",fill:"none"},[t("circle",{cx:"6",cy:"6.02026",r:"5.5",fill:"#53926D"})]),t("div",{class:"live-text"},"Live")],-1)),t("div",Mt,[t("div",Tt,w(o.nft.name),1),t("div",At,[t("div",Ut,w(o.nft.gameType),1)]),t("div",Bt,w(o.nft.description),1)])])]),t("div",It,[t("div",Vt,[s[5]||(s[5]=t("div",{class:"details-title-text"},"Start Date",-1)),t("div",Pt,w(c(o.nft.startDate)),1)]),t("div",Gt,[s[6]||(s[6]=t("div",{class:"details-title-text"},"End Date",-1)),t("div",Nt,w(c(o.nft.endDate)),1)]),t("div",jt,[s[7]||(s[7]=t("div",{class:"details-title-text"},"Remaining",-1)),t("div",Ft,w(a(o.nft.startDate,o.nft.endDate))+" days ",1)]),t("div",qt,[s[8]||(s[8]=t("div",{class:"details-award-text"},"Awards",-1)),t("div",Ht,w(n(o.nft.awards))+" USDC ",1)])])]),t("div",Lt,[t("div",Ot,[s[10]||(s[10]=t("div",{class:"question-title-text"},"Question",-1)),t("div",Et,[S(t("textarea",{class:"question-content-input",type:"text","onUpdate:modelValue":s[0]||(s[0]=e=>g.value=e)},null,512),[[k,g.value]]),t("div",{class:"submit-btn",onClick:s[1]||(s[1]=e=>T())},s[9]||(s[9]=[t("div",{class:"submit-text"},"Submit",-1)]))])]),t("div",zt,[s[11]||(s[11]=t("div",{class:"answer-title-text"},"Answer",-1)),t("div",Jt,w(m.value),1)]),t("div",Wt,[s[13]||(s[13]=t("div",{class:"pk-title-text"},"Secret",-1)),t("div",Rt,[S(t("textarea",{class:"pk-content-input",type:"text","onUpdate:modelValue":s[2]||(s[2]=e=>C.value=e)},null,512),[[k,C.value]]),t("div",{class:"submit-btn",onClick:s[3]||(s[3]=e=>V())},s[12]||(s[12]=[t("div",{class:"submit-text"},"Submit",-1)]))])])])])])]))}},Qt=q(Zt,[["__scopeId","data-v-8ffc91c1"]]),Kt={class:"modal"},Xt={class:"modal-container"},Yt={class:"modal-wrapper"},te={class:"content-wrapper"},ee={class:"content-left-wrapper"},se={class:"name-wrapper"},ae={class:"description-wrapper"},ne={class:"date-wrapper"},ie={class:"date-input-wrapper"},oe={class:"date-wrapper"},le={class:"date-input-wrapper"},re={class:"award-wrapper"},de={class:"award-input-wrapper"},ce={class:"content-right-wrapper"},fe={class:"type-wrapper"},pe={class:"type-content-secret-wrapper"},ve={class:"description-wrapper"},ue={class:"name-wrapper"},we={__name:"CreateModal",emits:["closeCreateModal"],setup(o,{emit:l}){const d=l,i=x({name:"",description:"",award:"",gameType:"secret",prompt:"",secret:"",start:0,end:0,winner:j}),f=x(""),h=x(""),v=x(""),y=x(""),g=x(""),m=x(0),{walletProvider:C}=O(),{address:T,chainId:V,isConnected:A}=E(),c=()=>{d("closeCreateModal")},a=s=>{m.value=s},n=()=>{if(f.value===""||h.value==""||v.value==""||y.value==""||g.value==""||!A.value||!h.value.includes(v.value))return!1;const s=new Date(y.value).getTime()/1e3,e=new Date(g.value).getTime()/1e3;return!(s>=e)},u=async()=>{if(n()){i.value.start=new Date(y.value).getTime()/1e3,i.value.end=new Date(g.value).getTime()/1e3,i.value.prompt=I(N(h.value)),i.value.secret=I(I(N(v.value)));const s=nt(f.value.toString(),18);await ut(i.value.prompt,h.value,i.value.secret,v.value),await ht(C.value,s),await xt(C.value,T.value,i.value,s)}};return(s,e)=>(b(),D("div",Kt,[t("div",Xt,[e[23]||(e[23]=t("div",{class:"title-text"},"Get started with a CTP",-1)),t("div",Yt,[t("div",{class:"close-wrapper"},[t("img",{src:z,alt:"close",onClick:c})]),e[22]||(e[22]=t("div",{class:"about-wrapper"},[t("div",{class:"about-text"},"Create A New Challenge")],-1)),t("div",te,[t("div",ee,[t("div",se,[e[8]||(e[8]=t("div",{class:"name-text"},"Name",-1)),S(t("input",{class:"name-input","onUpdate:modelValue":e[0]||(e[0]=r=>i.value.name=r),placeholder:"Name",type:"text"},null,512),[[k,i.value.name]])]),t("div",ae,[e[9]||(e[9]=t("div",{class:"description-text"},"Description",-1)),S(t("textarea",{class:"description-input","onUpdate:modelValue":e[1]||(e[1]=r=>i.value.description=r),placeholder:"Description"},null,512),[[k,i.value.description]])]),t("div",ne,[e[10]||(e[10]=t("div",{class:"date-text"},"Start Date",-1)),t("div",ie,[S(t("input",{class:"date-input","onUpdate:modelValue":e[2]||(e[2]=r=>y.value=r),type:"datetime-local"},null,512),[[k,y.value]])])]),t("div",oe,[e[11]||(e[11]=t("div",{class:"date-text"},"End Date",-1)),t("div",le,[S(t("input",{class:"date-input","onUpdate:modelValue":e[3]||(e[3]=r=>g.value=r),type:"datetime-local"},null,512),[[k,g.value]])])]),t("div",re,[e[13]||(e[13]=t("div",{class:"award-text"},"Award",-1)),t("div",de,[S(t("input",{class:"award-input","onUpdate:modelValue":e[4]||(e[4]=r=>f.value=r),type:"number"},null,512),[[k,f.value]]),e[12]||(e[12]=t("div",{class:"usdc-wrapper"},[t("div",{class:"usdc-text"},"USDC")],-1))])])]),t("div",ce,[t("div",fe,[e[17]||(e[17]=t("div",{class:"type-text"},"Type",-1)),t("div",pe,[t("div",{class:p(["type-content-wrapper",{"is-type-active":m.value==0}]),onClick:e[5]||(e[5]=r=>a(0))},e[14]||(e[14]=[t("div",{class:"type-content-text"},"Secret",-1)]),2),t("div",{class:p(["type-content-wrapper",{"is-type-active":m.value==1}])},e[15]||(e[15]=[t("div",{class:"type-content-text"},"Slang",-1)]),2),t("div",{class:p(["type-content-wrapper",{"is-type-active":m.value==2}])},e[16]||(e[16]=[t("div",{class:"type-content-text"},"Mismatch",-1)]),2)])]),t("div",ve,[e[18]||(e[18]=t("div",{class:"description-text"},"Prompt",-1)),S(t("textarea",{class:"prompt-input","onUpdate:modelValue":e[6]||(e[6]=r=>h.value=r),placeholder:"Prompt"},null,512),[[k,h.value]])]),t("div",ue,[e[19]||(e[19]=t("div",{class:"name-text"},"Secret",-1)),S(t("input",{class:"name-input","onUpdate:modelValue":e[7]||(e[7]=r=>v.value=r),placeholder:"Secret",type:"text"},null,512),[[k,v.value]])]),t("div",{class:"submit-wrapper"},[e[21]||(e[21]=t("div",{class:"empty-text"},null,-1)),t("div",{class:"submit-btn-wrapper",onClick:u},e[20]||(e[20]=[t("div",{class:"submit-btn-text"},"Submit",-1)]))])])])])])]))}},me=q(we,[["__scopeId","data-v-99ad3ca0"]]),ge={key:0,class:"challenge"},he={class:"challenge-wrapper"},xe={class:"challenge-live-filter"},ye={class:"challenge-type-filter-wrapper"},_e={class:"challenge-type-filter"},be={class:"nfts"},$e={class:"nft-content-wrapper"},Ce={class:"nft-content-top-wrapper"},Se=["src"],ke={class:"nft-content-top-title-wrapper"},De={class:"live-wrapper"},Me={key:0,xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 12 12",fill:"none"},Te=["fill"],Ae={key:1,xmlns:"http://www.w3.org/2000/svg",width:"19",height:"19",viewBox:"0 0 19 19",fill:"none"},Ue={class:"live-text"},Be={class:"live-title-wrapper"},Ie={class:"live-title-text"},Ve={class:"type-wrapper"},Pe={class:"type-text"},Ge={class:"nft-description"},Ne={class:"nft-date-wrapper"},je={class:"nft-date-content-wrapper"},Fe={class:"nft-date-content-text"},qe={class:"nft-date-content-text"},He={class:"nft-duration-wrapper"},Le={class:"nft-duration-content-text"},Oe={class:"nft-award-wrapper"},Ee=["onClick"],ze={class:"nft-btn-text"},Je={class:"pagination"},We={class:"pagination-wrapper"},Re={class:"number-wrapper"},Ze={__name:"ChallengePage",setup(o){const l=x(!1),d=x(!1),i=x(null),f=x([]),h=c=>{c.status==="Live"&&(i.value=c,l.value=!0)},v=()=>{l.value=!1},y=()=>{d.value=!0},g=()=>{d.value=!1},m=async()=>{const c=await pt(0,12);f.value=c.map(a=>{const n=a[11],u=Math.floor(Date.now()/1e3);console.log(n);let s="Live";return n.toLowerCase()==="0xffffffffffffffffffffffffffffffffffffffff"||n===j&&u>Number(a[9])?s="Verified":n!==j&&(s="Solved"),{status:s,winnerAddress:n,id:a[0],tokenId:a[1],name:a[2],description:a[3],gameType:a[4],promptHash:a[5],secretHash:a[6],imageUri:a[7],startDate:Number(a[8]),endDate:Number(a[9]),awards:Number(a[10])}}).reverse(),console.log(f.value)},C=c=>{const a=new Date(c*1e3),n=String(a.getUTCMonth()+1).padStart(2,"0"),u=String(a.getUTCDate()).padStart(2,"0"),s=a.getUTCHours(),e=String(a.getUTCMinutes()).padStart(2,"0"),r=s>=12?"PM":"AM",P=s%12||12;return`${n}.${u} ${P}:${e} ${r}`},T=(c,a)=>{const u=(a-c)/(60*60*24);return Math.round(u)},V=c=>lt(c.toLocaleString("fullwide",{useGrouping:!1}),18),A=c=>c&&`Winner: ${c.slice(0,6)}...${c.slice(-4)}`;return it(()=>{m()}),(c,a)=>(b(),D(L,null,[!l.value&&!d.value?(b(),D("div",ge,[t("div",he,[a[9]||(a[9]=t("div",{class:"challenge-title-text"},"Challenges",-1)),t("div",xe,[t("div",{class:p(["challenge-live-filter-btn",{"is-live-active":!0}])}," All "),t("div",{class:p(["challenge-live-filter-btn",{"is-live-active":!1}])}," Live "),t("div",{class:p(["challenge-live-filter-btn",{"is-live-active":!1}])}," End ")]),t("div",ye,[t("div",_e,[t("div",{class:p(["challenge-type-filter-btn",{"is-type-active":!0}])},[t("div",{class:p(["challenge-type-filter-btn-text",{"is-type-text-active":!0}])}," All Type ")]),t("div",{class:p(["challenge-type-filter-btn",{"is-type-active":!1}])},[t("div",{class:p(["challenge-type-filter-btn-text",{"is-type-text-active":!1}])}," Secret ")]),t("div",{class:p(["challenge-type-filter-btn",{"is-type-active":!1}])},[t("div",{class:p(["challenge-type-filter-btn-text",{"is-type-text-active":!1}])}," Slang ")]),t("div",{class:p(["challenge-type-filter-btn",{"is-type-active":!1}])},[t("div",{class:p(["challenge-type-filter-btn-text",{"is-type-text-active":!1}])}," Mismatch ")])]),t("div",{class:"challenge-create-new-btn",onClick:y}," + Create A New Challange ")]),t("div",be,[(b(!0),D(L,null,ot(f.value,(n,u)=>(b(),D("div",{key:n.id,class:p(["nft-wrapper",{"is-verified-nft":n.status==="Verified"}])},[t("div",$e,[t("div",Ce,[t("img",{src:n.imageUri?n.imageUri:"@/assets/nft/0.png",alt:"nft"},null,8,Se),t("div",ke,[t("div",De,[n.status!=="Verified"?(b(),D("svg",Me,[t("circle",{cx:"6",cy:"6.02026",r:"5.5",fill:n.status==="Live"?"#53926D":"#CC0000"},null,8,Te)])):B("",!0),n.status==="Verified"?(b(),D("svg",Ae,a[0]||(a[0]=[t("circle",{cx:"9.5",cy:"9.5",r:"8",fill:"#4DC4CF",stroke:"black","stroke-width":"2"},null,-1),t("rect",{x:"3.5",y:"7.91431",width:"2",height:"8.48528",transform:"rotate(-45 3.5 7.91431)",fill:"black"},null,-1),t("rect",{width:"2",height:"8.48563",transform:"matrix(-0.707107 -0.707107 -0.707107 0.707107 15.5 7.91431)",fill:"black"},null,-1)]))):B("",!0),t("div",Ue,w(n.status),1)]),t("div",Be,[t("div",Ie,w(n.name),1),t("div",Ve,[t("div",Pe,w(n.gameType),1)])])])]),t("div",Ge,w(n.description),1),t("div",Ne,[a[1]||(a[1]=t("div",{class:"nft-date-text"},"Date",-1)),t("div",je,[t("div",Fe,w(C(n.startDate)),1),t("div",qe," ~ "+w(C(n.endDate)),1)])]),t("div",He,[a[2]||(a[2]=t("div",{class:"nft-duration-text"},"Remaining",-1)),t("div",Le,w(T(n.startDate,n.endDate))+" days ",1)]),t("div",Oe,[t("div",{class:p(["nft-award-text",{"is-verified-nft-text":n.status==="Verified"}])}," Award ",2),t("div",{class:p(["nft-award-content-text",{"is-verified-nft-text":n.status==="Verified","is-solved-nft-text":n.status==="Solved"}])},w(V(n.awards))+" USDC ",3)])]),t("div",{class:p(["nft-btn",{"is-live":n.status==="Live","is-verified":n.status==="Verified"}]),onClick:s=>n.status!=="Solved"&&h(n)},[t("div",ze,w(n.status==="Solved"?A(n.winnerAddress):n.status==="Verified"?"Verified":"Challenge"),1)],10,Ee)],2))),128))]),t("div",Je,[t("div",We,[a[7]||(a[7]=t("img",{src:wt,alt:"left"},null,-1)),t("div",Re,[t("div",{class:p(["number-text",{"is-pagination-active":!0}])}," 1 "),a[3]||(a[3]=t("div",{class:"number-text"},"2",-1)),a[4]||(a[4]=t("div",{class:"number-text"},"3",-1)),a[5]||(a[5]=t("div",{class:"number-text"},"4",-1)),a[6]||(a[6]=t("div",{class:"number-text"},"5",-1))]),a[8]||(a[8]=t("img",{src:mt,alt:"right"},null,-1))])])])])):B("",!0),l.value?(b(),F(Qt,{key:1,nft:i.value,onCloseModal:v},null,8,["nft"])):B("",!0),d.value?(b(),F(me,{key:2,onCloseCreateModal:g})):B("",!0)],64))}},Qe=q(Ze,[["__scopeId","data-v-f15a648d"]]),Ye={__name:"ChallengeView",setup(o){return(l,d)=>(b(),F(Qe))}};export{Ye as default};
